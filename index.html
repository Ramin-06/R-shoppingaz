<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R-Shoppingaz</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --dark-blue: #003366;
            --main-blue: #00509d;
            --bright-orange: #ff8c00;
            --light-bg: #f8f9fa;
        }

        body { font-family: 'Segoe UI', sans-serif; margin: 0; background-color: var(--light-bg); overflow-x: hidden; }
        
        /* Səhifə sistemləri */
        .page { display: none; padding: 15px; animation: fadeIn 0.3s; min-height: 100vh; box-sizing: border-box; }
        .page.active { display: block !important; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Header & Search */
        .header-fixed { position: sticky; top: 0; background: var(--light-bg); z-index: 1000; padding: 10px 15px; }
        .search-container { background: #fff; padding: 12px; border-radius: 15px; display: flex; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .search-container input { border: none; outline: none; width: 100%; margin-left: 10px; font-size: 15px; }

        /* Slider */
        .slider-area { display: flex; overflow-x: auto; gap: 10px; scrollbar-width: none; margin-bottom: 20px; cursor: grab; padding: 5px 0; }
        .slider-area::-webkit-scrollbar { display: none; }
        .slide-card { min-width: 85%; height: 160px; background: #eee; border-radius: 20px; overflow: hidden; flex-shrink: 0; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .slide-card img { width: 100%; height: 100%; object-fit: cover; }

        /* Grid */
        .product-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        @media (min-width: 768px) { .product-grid { grid-template-columns: repeat(4, 1fr); } }

        /* Card */
        .product-card { background: white; border-radius: 18px; padding: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); text-align: center; position: relative; }
        .product-card h4 { margin: 8px 0; font-size: 14px; color: var(--dark-blue); height: 35px; overflow: hidden; }
        .price-text { color: var(--main-blue); font-weight: bold; margin-bottom: 10px; display: block; }
        .btn-add { background: var(--bright-orange); color: white; border: none; padding: 10px; border-radius: 12px; width: 100%; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-add:active { transform: scale(0.95); }

        /* Modallar (Tam Ekran) */
        #productDetail, #infoModal, #adminPage, #adminLoginModal { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: white; z-index: 10000; display: none; overflow-y: auto; 
        }
        .modal-active { display: block !important; }

        .det-header { position: sticky; top: 0; background: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; z-index: 101; }

        /* Bottom Nav */
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; height: 65px; background: white; display: flex; justify-content: space-around; align-items: center; border-top: 1px solid #eee; z-index: 5000; padding-bottom: env(safe-area-inset-bottom); }
        .nav-item { text-align: center; color: #999; font-size: 11px; cursor: pointer; flex: 1; transition: 0.3s; }
        .nav-item.active { color: var(--main-blue); font-weight: bold; }
        .badge { position: absolute; top: 5px; right: 25%; background: var(--bright-orange); color: white; font-size: 10px; width: 16px; height: 16px; border-radius: 50%; display: none; align-items: center; justify-content: center; border: 2px solid #fff; }

        /* Tables */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 14px; }
        th, td { padding: 10px; border: 1px solid #eee; }
        th { background: var(--main-blue); color: white; }

        /* Star Rating */
        .star-rating i { font-size: 24px; color: #ccc; cursor: pointer; margin-right: 5px; }

        .admin-section { padding: 10px 0; }
        .filter-scroll { display: flex; overflow-x: auto; gap: 10px; margin-bottom: 15px; padding-bottom: 5px; }
        .filter-btn { padding: 8px 18px; border-radius: 20px; border: 1px solid #ddd; background: #fff; white-space: nowrap; cursor: pointer; }
        .filter-btn.active { background: var(--main-blue); color: #fff; border-color: var(--main-blue); }
    </style>
</head>
<body>

    <div id="infoModal">
        <div class="det-header">
            <i class="fas fa-arrow-left" onclick="closeModal('infoModal')" style="font-size:22px;"></i>
            <b id="infoModalTitle">Məlumat</b>
            <div style="width:22px;"></div>
        </div>
        <div id="infoModalBody" style="padding:20px;"></div>
    </div>

    <div id="productDetail">
        <div class="det-header">
            <i class="fas fa-arrow-left" onclick="closeModal('productDetail')" style="font-size:22px;"></i>
            <b id="detHeaderName">Xüsusiyyətlər</b>
            <i class="fas fa-heart" id="detFavBtn" onclick="toggleFavFromDetail()" style="font-size:22px;"></i>
        </div>
        <div style="padding:20px; padding-bottom: 100px;">
            <div id="detImg" style="text-align:center; margin-bottom:20px;"></div>
            <h2 id="detTitle" style="color:var(--dark-blue); margin:0;"></h2>
            <span id="detPrice" style="color:var(--main-blue); font-size:24px; font-weight:bold;"></span>
            
            <p style="font-weight:bold; margin-top:20px;">Ölçü seçin:</p>
            <div style="display:flex; gap:10px;">
                <button class="filter-btn active size-btn" onclick="updatePrice(this, 30, 10)">30 ml</button>
                <button class="filter-btn size-btn" onclick="updatePrice(this, 50, 13)">50 ml</button>
            </div>

            <p style="font-weight:bold; margin-top:20px;">Sayı:</p>
            <div style="display:flex; align-items:center; gap:20px; background:#f1f1f1; width:fit-content; padding:8px 20px; border-radius:25px;">
                <button onclick="changeQty(-1)" style="border:none; background:none; font-size:20px;">-</button>
                <span id="qtyVal" style="font-weight:bold;">1</span>
                <button onclick="changeQty(1)" style="border:none; background:none; font-size:20px;">+</button>
            </div>

            <button class="btn-add" style="margin-top:25px; padding:15px;" onclick="addToCart()">SƏBƏTƏ ƏLAVƏ ET</button>

            <div style="margin-top:30px; border-top:1px solid #eee; padding-top:20px;">
                <div style="margin-bottom:10px;"><i class="fas fa-wind" style="color:var(--bright-orange); width:25px;"></i> <b>Qoxu:</b> <span id="detNotes"></span></div>
                <div style="margin-bottom:10px;"><i class="fas fa-hourglass-half" style="color:var(--bright-orange); width:25px;"></i> <b>Qalıcılıq:</b> <span id="detStay"></span></div>
                <div style="margin-bottom:10px;"><i class="fas fa-check-circle" style="color:var(--bright-orange); width:25px;"></i> <b>Kateqoriya:</b> <span id="detCat"></span></div>
            </div>

            <div id="reviewsSection" style="margin-top:40px;">
                <h3>İstifadəçi Rəyləri</h3>
                <div id="ratingStats" style="background:#f9f9f9; padding:15px; border-radius:15px; margin-bottom:20px;"></div>
                
                <div style="background:#fff; border:1px solid #eee; padding:15px; border-radius:15px;">
                    <input type="text" id="reviewerName" placeholder="Adınız" style="width:100%; padding:10px; margin-bottom:10px; border-radius:10px; border:1px solid #ddd; box-sizing:border-box;">
                    <div class="star-rating" style="margin-bottom:10px;">
                        <i class="fas fa-star" data-rating="1" onclick="setRating(1)"></i>
                        <i class="fas fa-star" data-rating="2" onclick="setRating(2)"></i>
                        <i class="fas fa-star" data-rating="3" onclick="setRating(3)"></i>
                        <i class="fas fa-star" data-rating="4" onclick="setRating(4)"></i>
                        <i class="fas fa-star" data-rating="5" onclick="setRating(5)"></i>
                    </div>
                    <textarea id="reviewText" placeholder="Fikirləriniz..." style="width:100%; height:80px; padding:10px; border-radius:10px; border:1px solid #ddd; box-sizing:border-box;"></textarea>
                    <button class="btn-add" style="margin-top:10px;" onclick="submitReview()">RƏY BİLDİR</button>
                </div>
                <div id="reviewsList" style="margin-top:20px;"></div>
            </div>
        </div>
    </div>

    <div id="homePage" class="page active">
        <div class="header-fixed">
            <div style="text-align:center; margin-bottom:10px;">
                <img src="https://raw.githubusercontent.com/Ramin-06/R-Shoppingaz/main/logo_baslig.png" style="height:35px;">
            </div>
            <div class="search-container">
                <i class="fas fa-search" style="color:#ccc"></i>
                <input type="text" id="searchInput" placeholder="Ətir axtar..." oninput="searchPerfume()">
            </div>
        </div>
        <div class="slider-area" id="slider">
            <div class="slide-card" onclick="openCampaignModal()">
                <img src="https://raw.githubusercontent.com/Ramin-06/R-Shoppingaz/main/kampaniya_sertleri.jpg">
            </div>
            <div class="slide-card" onclick="openDeliveryModal()">
                <img src="https://raw.githubusercontent.com/Ramin-06/R-Shoppingaz/main/xidmetler_ve_catdirilma.jpg">
            </div>
        </div>
        <h4 id="gridTitle" style="color:var(--dark-blue); margin:10px 0;">Məhsullar</h4>
        <div id="homeGrid" class="product-grid"></div>
        <div style="height:80px;"></div>
    </div>

    <div id="catalogPage" class="page">
        <h4 style="color:var(--dark-blue);">Kataloq</h4>
        <div class="filter-scroll">
            <button class="filter-btn active" onclick="applyFilter('all', this)">Hamısı</button>
            <button class="filter-btn" onclick="applyFilter('qadin', this)">Qadın</button>
            <button class="filter-btn" onclick="applyFilter('kisi', this)">Kişi</button>
            <button class="filter-btn" onclick="applyFilter('unisex', this)">Unisex</button>
        </div>
        <div id="catalogGrid" class="product-grid"></div>
        <div style="height:80px;"></div>
    </div>

    <div id="favPage" class="page">
        <h4 style="color:var(--dark-blue);">Favorilərim</h4>
        <div id="favGrid" class="product-grid"></div>
        <div id="favEmpty" style="text-align:center; padding:50px; color:#ccc; display:none;">
            <i class="far fa-heart" style="font-size:50px;"></i>
            <p>Heç nə tapılmadı</p>
        </div>
        <div style="height:80px;"></div>
    </div>

    <div id="cartPage" class="page">
        <h4 style="color:var(--dark-blue);">Səbətim</h4>
        <div id="cartList"></div>
        <div id="cartFooter" style="padding-bottom:100px;"></div>
    </div>

    <div id="adminLoginModal">
        <div style="padding:40px 20px; text-align:center;">
            <i class="fas fa-user-shield" style="font-size:50px; color:var(--main-blue); margin-bottom:20px;"></i>
            <h2>Admin Girişi</h2>
            <input type="text" id="adminID" placeholder="Admin ID" style="width:100%; padding:15px; margin-bottom:10px; border-radius:12px; border:1px solid #ddd; box-sizing:border-box;">
            <input type="password" id="adminPass" placeholder="Şifrə" style="width:100%; padding:15px; margin-bottom:20px; border-radius:12px; border:1px solid #ddd; box-sizing:border-box;">
            <button class="btn-add" onclick="checkAdminLogin()">DAXİL OL</button>
            <p onclick="closeModal('adminLoginModal')" style="margin-top:20px; color:#888;">Geri qayıt</p>
        </div>
    </div>

    <div id="adminPage">
        <div class="det-header">
            <b>Admin Panel</b>
            <i class="fas fa-times" onclick="closeModal('adminPage')" style="font-size:22px;"></i>
        </div>
        <div style="padding:20px;">
            <div style="display:flex; gap:10px; margin-bottom:20px; background:#eee; padding:5px; border-radius:15px;">
                <button id="tabAdd" class="filter-btn active" style="flex:1" onclick="switchAdminTab('add')">Əlavə et</button>
                <button id="tabList" class="filter-btn" style="flex:1" onclick="switchAdminTab('list')">Siyahı</button>
            </div>

            <div id="sectAdd">
                <h4 id="formTitle">Yeni Məhsul</h4>
                <input type="text" id="adminProdName" placeholder="Məhsul adı" style="width:100%; padding:12px; margin-bottom:10px; border-radius:10px; border:1px solid #ddd; box-sizing:border-box;">
                <select id="adminProdCat" style="width:100%; padding:12px; margin-bottom:10px; border-radius:10px; border:1px solid #ddd;">
                    <option value="qadin">Qadın</option>
                    <option value="kisi">Kişi</option>
                    <option value="unisex">Unisex</option>
                </select>
                <input type="text" id="adminProdNotes" placeholder="Qoxu notları" style="width:100%; padding:12px; margin-bottom:10px; border-radius:10px; border:1px solid #ddd; box-sizing:border-box;">
                <input type="text" id="adminProdStay" placeholder="Qalıcılıq" style="width:100%; padding:12px; margin-bottom:10px; border-radius:10px; border:1px solid #ddd; box-sizing:border-box;">
                <button id="adminSaveBtn" class="btn-add" onclick="saveProductToFirebase()" style="background:#27ae60">YADDA SAXLA</button>
                <button id="cancelEditBtn" onclick="resetAdminForm()" style="display:none; width:100%; border:none; background:none; margin-top:10px; color:red;">Ləğv et</button>
            </div>

            <div id="sectList" style="display:none;">
                <div id="adminProductList"></div>
            </div>
        </div>
    </div>

    <nav class="bottom-nav" id="mainNav">
        <div class="nav-item active" onclick="showPage('homePage', this)"><i class="fas fa-home"></i><br>Əsas</div>
        <div class="nav-item" onclick="showPage('catalogPage', this)"><i class="fas fa-th-large"></i><br>Kataloq</div>
        <div class="nav-item" onclick="showPage('favPage', this)"><i class="fas fa-heart"></i><br>Favori</div>
        <div class="nav-item" onclick="showPage('cartPage', this)"><i class="fas fa-shopping-cart"></i><div id="cartBadge" class="badge">0</div><br>Səbət</div>
        <div class="nav-item" onclick="openAdminModal()"><i class="fas fa-user-lock"></i><br>Kabinet</div>
    </nav>

    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

    <script>
        // FIREBASE CONFIG (Senin melumatlarin)
        const firebaseConfig = {
          apiKey: "AIzaSyA5eb16DAKSVLkEzYsUrgxL9vfrJP7w-es",
          authDomain: "etir-magazasi-d7679.firebaseapp.com",
          projectId: "etir-magazasi-d7679",
          storageBucket: "etir-magazasi-d7679.firebasestorage.app",
          messagingSenderId: "1045258773680",
          appId: "1:1045258773680:web:ab2edd54ba3f0ef0530775"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // DEYISENLER
        let products = [], cart = [], favs = [], currentProd = null;
        let selectedRating = 0, currentQty = 1, selectedSize = 30, currentPrice = 10;
        let editMode = false, editId = null;

        // SEHIFE IDARESI
        function showPage(pId, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(pId).classList.add('active');
            if(el) el.classList.add('active');
            
            if(pId === 'favPage') renderFavs();
            if(pId === 'cartPage') renderCart();
            window.scrollTo(0,0);
        }

        function openModal(mId) {
            document.getElementById(mId).style.display = 'block';
            document.getElementById('mainNav').style.display = 'none'; // Naviqasiyani gizle
        }

        function closeModal(mId) {
            document.getElementById(mId).style.display = 'none';
            document.getElementById('mainNav').style.display = 'flex'; // Naviqasiyani qaytar
        }

        // FIREBASE DATA
        function fetchProducts() {
            db.collection("products").onSnapshot(snap => {
                products = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderAll();
                if(document.getElementById('sectList').style.display === 'block') renderAdminList();
            });
        }

        function renderAll() {
            const html = products.map(p => createCard(p)).join('');
            document.getElementById('homeGrid').innerHTML = html;
            document.getElementById('catalogGrid').innerHTML = html;
        }

        function createCard(p) {
            const isFav = favs.some(f => f.id === p.id);
            const img = "https://raw.githubusercontent.com/Ramin-06/R-Shoppingaz/main/card_pic.png";
            return `
                <div class="product-card">
                    <i class="fas fa-heart" style="position:absolute; top:12px; right:12px; color:${isFav?'#ff4757':'#ddd'}; z-index:10;" onclick="toggleFav(event, '${p.id}')"></i>
                    <div onclick="openProductDetail('${p.id}')">
                        <img src="${img}" style="width:100%; height:120px; object-fit:contain;">
                        <h4>${p.name}</h4>
                        <span class="price-text">10 - 13 AZN</span>
                    </div>
                    <button class="btn-add" onclick="openProductDetail('${p.id}')">SEÇİM ET</button>
                </div>`;
        }

        // DETAL SEHIFESI
        function openProductDetail(id) {
            currentProd = products.find(p => p.id === id);
            if(!currentProd) return;

            currentQty = 1; selectedSize = 30; currentPrice = 10;
            document.getElementById('qtyVal').innerText = currentQty;
            document.getElementById('detTitle').innerText = currentProd.name;
            document.getElementById('detPrice').innerText = "10 AZN";
            document.getElementById('detNotes').innerText = currentProd.notes || "-";
            document.getElementById('detStay').innerText = currentProd.stay || "-";
            document.getElementById('detCat').innerText = currentProd.cat.toUpperCase();
            document.getElementById('detImg').innerHTML = `<img src="https://raw.githubusercontent.com/Ramin-06/R-Shoppingaz/main/card_pic.png" style="max-height:200px;">`;
            
            const isFav = favs.some(f => f.id === id);
            document.getElementById('detFavBtn').style.color = isFav ? '#ff4757' : '#ccc';

            openModal('productDetail');
            fetchReviews(id);
        }

        // REY SISTEMI
        function setRating(r) {
            selectedRating = r;
            const stars = document.querySelectorAll('.star-rating i');
            stars.forEach((s, idx) => s.style.color = idx < r ? '#ff8c00' : '#ccc');
        }

        async function submitReview() {
            const name = document.getElementById('reviewerName').value.trim();
            const text = document.getElementById('reviewText').value.trim();
            if(!name || !text || selectedRating === 0) return alert("Bütün sahələri doldurun!");

            await db.collection("reviews").add({
                productId: currentProd.id,
                userName: name,
                rating: selectedRating,
                comment: text,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            document.getElementById('reviewerName').value = "";
            document.getElementById('reviewText').value = "";
            setRating(0);
            alert("Rəyiniz əlavə edildi!");
        }

        function fetchReviews(pId) {
            db.collection("reviews").where("productId", "==", pId).orderBy("timestamp", "desc").onSnapshot(snap => {
                const list = document.getElementById('reviewsList');
                let html = "";
                snap.forEach(doc => {
                    const r = doc.data();
                    html += `<div style="border-bottom:1px solid #eee; padding:10px 0;">
                        <b>${r.userName}</b> <span style="color:#ff8c00; font-size:12px;">${'★'.repeat(r.rating)}</span>
                        <p style="margin:5px 0; font-size:14px; color:#555;">${r.comment}</p>
                    </div>`;
                });
                list.innerHTML = html || "<p style='color:#999'>Hələ rəy yoxdur.</p>";
            });
        }

        // SEBET
        function addToCart() {
            const item = { ...currentProd, qty: currentQty, size: selectedSize, price: currentPrice };
            const exist = cart.find(c => c.id === item.id && c.size === item.size);
            if(exist) exist.qty += currentQty; else cart.push(item);
            updateBadge();
            closeModal('productDetail');
        }

        function updateBadge() {
            const count = cart.reduce((s, i) => s + i.qty, 0);
            const b = document.getElementById('cartBadge');
            b.innerText = count;
            b.style.display = count > 0 ? 'flex' : 'none';
        }

        function renderCart() {
            const list = document.getElementById('cartList');
            const footer = document.getElementById('cartFooter');
            if(cart.length === 0) {
                list.innerHTML = "<p style='text-align:center; padding:50px; color:#999;'>Səbətiniz boşdur.</p>";
                footer.innerHTML = "";
                return;
            }
            let total = 0;
            list.innerHTML = cart.map((item, i) => {
                total += item.price * item.qty;
                return `<div style="background:#fff; padding:15px; border-radius:15px; margin-bottom:10px; display:flex; justify-content:space-between; align-items:center;">
                    <div><b>${item.name}</b> (${item.size}ml)<br><small>${item.qty} ədəd x ${item.price} AZN</small></div>
                    <div style="font-weight:bold;">${item.price * item.qty} AZN <i class="fas fa-trash" style="color:red; margin-left:10px;" onclick="remCart(${i})"></i></div>
                </div>`;
            }).join('');
            footer.innerHTML = `<div style="padding:15px; font-size:18px; font-weight:bold; display:flex; justify-content:space-between;"><span>Cəmi:</span><span>${total} AZN</span></div>
                <button class="btn-add" style="background:var(--main-blue); padding:15px;" onclick="checkout()">SİFARİŞİ TAMAMLA</button>`;
        }

        function remCart(i) { cart.splice(i, 1); updateBadge(); renderCart(); }

        // WHATSAPP SIFARIS
        function checkout() {
            const total = cart.reduce((s, i) => s + (i.price * i.qty), 0);
            const html = `
                <div id="checkoutBox" style="background:#fff; padding:20px; border-radius:20px; margin-top:20px; border:1px solid #ddd;">
                    <h3>Sifarişi Tamamla</h3>
                    <p style="font-size:13px;">Ödənişi karta edin və ünvanınızı yazın:</p>
                    <div style="background:#f0f0f0; padding:10px; border-radius:10px; margin-bottom:15px;">
                        <small>Kart: <b>4169 7388 2013 3274</b></small>
                    </div>
                    <input type="text" id="userAddress" placeholder="Çatdırılma ünvanı..." style="width:100%; padding:12px; margin-bottom:15px; border-radius:10px; border:1px solid #ddd; box-sizing:border-box;">
                    <button class="btn-add" style="background:#25D366;" onclick="sendToWA(${total})">WHATSAPP İLƏ GÖNDƏR</button>
                </div>`;
            document.getElementById('cartFooter').innerHTML += html;
            window.scrollTo(0, document.body.scrollHeight);
        }

        function sendToWA(total) {
            const addr = document.getElementById('userAddress').value;
            if(!addr) return alert("Ünvan yazın!");
            let msg = "*YENİ SİFARİŞ*\n\n";
            cart.forEach(i => msg += `• ${i.name} (${i.size}ml) - ${i.qty} ədəd\n`);
            msg += `\n*Ünvan:* ${addr}\n*Cəmi:* ${total} AZN`;
            window.location.href = `https://wa.me/994515817772?text=${encodeURIComponent(msg)}`;
        }

        // ADMIN FUNKSIYALARI
        function openAdminModal() { openModal('adminLoginModal'); }
        async function checkAdminLogin() {
            const id = document.getElementById('adminID').value;
            const pass = document.getElementById('adminPass').value;
            const snap = await db.collection("admins").get();
            let found = false;
            snap.forEach(doc => {
                if(doc.data().adminID == id && doc.data().password == pass) found = true;
            });
            if(found) {
                closeModal('adminLoginModal');
                openModal('adminPage');
            } else alert("Məlumatlar səhvdir!");
        }

        function switchAdminTab(t) {
            document.getElementById('sectAdd').style.display = t === 'add' ? 'block' : 'none';
            document.getElementById('sectList').style.display = t === 'list' ? 'block' : 'none';
            document.getElementById('tabAdd').classList.toggle('active', t === 'add');
            document.getElementById('tabList').classList.toggle('active', t === 'list');
            if(t === 'list') renderAdminList();
        }

        async function saveProductToFirebase() {
            const data = {
                name: document.getElementById('adminProdName').value,
                cat: document.getElementById('adminProdCat').value,
                notes: document.getElementById('adminProdNotes').value,
                stay: document.getElementById('adminProdStay').value
            };
            if(editMode) await db.collection("products").doc(editId).update(data);
            else await db.collection("products").add(data);
            resetAdminForm();
            alert("Uğurla yadda saxlanıldı!");
        }

        function renderAdminList() {
            document.getElementById('adminProductList').innerHTML = products.map(p => `
                <div style="background:#fff; padding:10px; margin-bottom:8px; border-radius:10px; display:flex; justify-content:space-between;">
                    <span>${p.name}</span>
                    <div>
                        <i class="fas fa-edit" style="color:orange; margin-right:15px;" onclick="editProduct('${p.id}')"></i>
                        <i class="fas fa-trash" style="color:red;" onclick="deleteProduct('${p.id}')"></i>
                    </div>
                </div>`).join('');
        }

        function deleteProduct(id) { if(confirm("Silinsin?")) db.collection("products").doc(id).delete(); }

        function editProduct(id) {
            const p = products.find(i => i.id === id);
            document.getElementById('adminProdName').value = p.name;
            document.getElementById('adminProdNotes').value = p.notes;
            document.getElementById('adminProdStay').value = p.stay;
            editMode = true; editId = id;
            document.getElementById('adminSaveBtn').innerText = "YENİLƏ";
            document.getElementById('cancelEditBtn').style.display = "block";
            switchAdminTab('add');
        }

        function resetAdminForm() {
            editMode = false; editId = null;
            document.getElementById('adminProdName').value = "";
            document.getElementById('adminSaveBtn').innerText = "YADDA SAXLA";
            document.getElementById('cancelEditBtn').style.display = "none";
        }

        // DIGER
        function updatePrice(btn, s, p) {
            selectedSize = s; currentPrice = p;
            document.querySelectorAll('.size-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById('detPrice').innerText = p + " AZN";
        }

        function changeQty(v) { currentQty = Math.max(1, currentQty + v); document.getElementById('qtyVal').innerText = currentQty; }

        function toggleFav(e, id) {
            e.stopPropagation();
            const idx = favs.findIndex(f => f.id === id);
            if(idx > -1) favs.splice(idx, 1);
            else favs.push(products.find(p => p.id === id));
            renderAll();
        }

        function toggleFavFromDetail() {
            toggleFav({stopPropagation:()=>{}}, currentProd.id);
            const isFav = favs.some(f => f.id === currentProd.id);
            document.getElementById('detFavBtn').style.color = isFav ? '#ff4757' : '#ccc';
        }

        function renderFavs() {
            const grid = document.getElementById('favGrid');
            const empty = document.getElementById('favEmpty');
            if(favs.length === 0) { grid.innerHTML = ""; empty.style.display = "block"; }
            else { empty.style.display = "none"; grid.innerHTML = favs.map(p => createCard(p)).join(''); }
        }

        function searchPerfume() {
            const q = document.getElementById('searchInput').value.toLowerCase();
            const filtered = products.filter(p => p.name.toLowerCase().includes(q));
            document.getElementById('homeGrid').innerHTML = filtered.map(p => createCard(p)).join('');
        }

        function applyFilter(cat, btn) {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            const filtered = cat === 'all' ? products : products.filter(p => p.cat === cat);
            document.getElementById('catalogGrid').innerHTML = filtered.map(p => createCard(p)).join('');
        }

        function openCampaignModal() {
            document.getElementById('infoModalTitle').innerText = "Kampaniya Şərtləri";
            document.getElementById('infoModalBody').innerHTML = `
                <p>30 ml ətirlər: 10 AZN, 50 ml ətirlər: 13 AZN.</p>
                <table><tr><th>Sayı</th><th>30ml</th><th>50ml</th></tr><tr><td>5 ədəd</td><td>32 AZN</td><td>45 AZN</td></tr></table>`;
            openModal('infoModal');
        }

        function openDeliveryModal() {
            document.getElementById('infoModalTitle').innerText = "Çatdırılma";
            document.getElementById('infoModalBody').innerHTML = "<p>Şəhərdaxili çatdırılma pulsuzdur.</p>";
            openModal('infoModal');
        }

        // START
        fetchProducts();
    </script>
</body>
</html>
